<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script type="text/javascript">
    $(function () {
        $('#item_table').datagrid({
            url: '/showItem',
            columns: [[
                {field: 'Id', title: '商品ID', width: 100},
                {field: 'Title', title: '商品标题', width: 100},
                {field: 'CategoryName', title: '叶子类目', width: 100},
                {field: 'SellPoint', title: '卖点', width: 100},
                {field: 'Price', title: '价格', width: 100},
                {field: 'Num', title: '库存数量', width: 100},
                {field: 'Barcode', title: '条形码', width: 100},
                {field: 'Status', title: '状态', width: 100,formatter: function(value,row,index){
                        if (value==1){
                            return "正常";
                        }else if (value==2){
                            return "<span style='color:blue'>下架</span>";
                        }else if (value==3){
                            return "<span style='color:red'>删除</span>";
                        }
                    }
                },
                {field: 'Created', title: '创建日期', width: 100},
                {field: 'Updated', title: '更新日期', width: 100}
            ]],
            fitColumns: true,
            striped: true,
            rownumbers: true,
            pagination:true,
            toolbar: [{
                iconCls: 'icon-add',
                text: '新增',
                handler: function () {
                    var node="新增商品"
                    if($("#index_tabes").tabs("getTab",node)){
                        $("#index_tabes").tabs("select",node)
                    }else{
                        $('#index_tabes').tabs('add',{
                            title: node,
                            selected: true,
                            href:'/page/item_add'
                        });
                    }
                }
            }, {
                iconCls: 'icon-edit',
                text: '编辑',
                handler: function () {
                    alert('编辑')
                }
            }, {
                iconCls: 'icon-cancel',
                text: '删除',
                handler: function () {
                    var ss=$("#item_table").datagrid("getSelections");
                    if(ss.length<=0){
                        $.messager.alert("系统消息","请选择要删除的数据","warning")
                    }else{
                        var ids="";
                        for (var i=0;i<ss.length;i++){
                            ids+=ss[i].Id;
                            if (i <ss.length-1){
                                ids+=",";
                            }
                        }
                        $.post("/item/delete",{"ids":ids},function (data) {
                            if (data.Status==200){
                                $.messager.show({
                                    title:'系统消息',
                                    msg:'删除'+ids+'成功',
                                    showType:'show',
                                    showType:'slide'
                                });
                                $("#item_table").datagrid("reload")
                            }else{
                                $.messager.show({
                                    title:'系统消息',
                                    msg:'删除失败',
                                    showType:'show',
                                    showType:'slide'
                                });
                            }
                        })
                    }
                }
            }, '-', {
                iconCls: 'icon-remove',
                text: '上架',
                handler: function () {
                    var ss=$("#item_table").datagrid("getSelections");
                    if(ss.length<=0){
                        $.messager.alert("系统消息","请选择要上架的数据","warning")
                    }else{
                        var ids="";
                        for (var i=0;i<ss.length;i++){
                            ids+=ss[i].Id;
                            if (i <ss.length-1){
                                ids+=",";
                            }
                        }
                        $.post("/item/instock",{"ids":ids},function (data) {
                            if (data.Status==200){
                                $.messager.show({
                                    title:'系统消息',
                                    msg:'上架'+ids+'成功',
                                    showType:'show',
                                    showType:'slide'
                                });
                                $("#item_table").datagrid("reload")
                            }else{
                                $.messager.show({
                                    title:'系统消息',
                                    msg:'上架失败,请检查商品是否已经处于正常状态',
                                    showType:'show',
                                    showType:'slide'
                                });
                            }
                        })
                    }
                }
            }, {
                iconCls: 'icon-remove',
                text: '下架',
                handler: function () {
                    var ss=$("#item_table").datagrid("getSelections");
                    if(ss.length<=0){
                        $.messager.alert("系统消息","请选择要下架的数据","warning")
                    }else{
                        var ids="";
                        for (var i=0;i<ss.length;i++){
                            ids+=ss[i].Id;
                            if (i <ss.length-1){
                                ids+=",";
                            }
                        }
                        $.post("/item/offstock",{"ids":ids},function (data) {
                            if (data.Status==200){
                                $.messager.show({
                                    title:'系统消息',
                                    msg:'下架'+ids+'成功',
                                    showType:'show',
                                    showType:'slide'
                                });
                                $("#item_table").datagrid("reload")
                            }else{
                                $.messager.show({
                                    title:'系统消息',
                                    msg:'下架失败,请检查商品是否已经处于下架状态',
                                    showType:'show',
                                    showType:'slide'
                                });
                            }
                        })
                    }
                }
            }]

        });
    })
</script>
<table id="item_table"></table>
</body>
</html>